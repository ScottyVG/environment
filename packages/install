#!/usr/bin/env bash
set -euo pipefail
shopt -s nullglob

export HOST=$(hostnamectl --static)
GROUP="./group/${HOST}"

if [[ ! -d $GROUP ]]; then
  echo "❌  No package list for host '$HOST' (expected $GROUP)" >&2
  exit 1
fi

# define your AUR helper or bail
if command -v paru &> /dev/null; then
  AUR_HELPER=paru
elif command -v yay &> /dev/null; then
  AUR_HELPER=yay
else
  echo "❌  No AUR helper found (paru or yay). Install one first." >&2
  exit 1
fi

for file in "$GROUP"/*; do
  echo "📦 [official] Installing from $file…"
  # installs only from the official repos, skips AUR errors
  sudo pacman -Sy --needed --noconfirm - < "$file" || true

  echo "📦 [AUR] Installing from $file…"
  $AUR_HELPER -S --needed --asexplicit - < "$file"
done
